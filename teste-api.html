<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Google Maps API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üß™ Teste Google Maps API</h1>
            <p class="text-gray-600">Verificando integra√ß√£o com a API do Google Maps</p>
        </div>

        <!-- Status da API -->
        <div id="status-card" class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Status da API</h2>
            <div id="api-status" class="space-y-2">
                <div class="flex items-center text-gray-600">
                    <span class="loading mr-2"></span>
                    Verificando conex√£o...
                </div>
            </div>
        </div>

        <!-- Teste de Dist√¢ncia -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Teste de C√°lculo de Dist√¢ncia e Custo</h2>

            <!-- Modo de entrada -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Modo de entrada:</label>
                <div class="flex gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="modoEntrada" value="select" checked onchange="toggleModoEntrada()" class="mr-2">
                        <span>Munic√≠pios pr√©-definidos</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="modoEntrada" value="livre" onchange="toggleModoEntrada()" class="mr-2">
                        <span>Endere√ßos personalizados</span>
                    </label>
                </div>
            </div>

            <!-- Selects (modo padr√£o) -->
            <div id="modo-select" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Origem</label>
                    <select id="origem" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="Jaboat√£o dos Guararapes, PE">Jaboat√£o dos Guararapes</option>
                        <option value="Recife, PE">Recife</option>
                        <option value="Olinda, PE">Olinda</option>
                        <option value="Paulista, PE">Paulista</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Destino (UPA)</label>
                    <select id="destino" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="Cabo de Santo Agostinho, PE">Cabo de Santo Agostinho</option>
                        <option value="Igarassu, PE">Igarassu</option>
                        <option value="Recife, PE">Recife</option>
                        <option value="Olinda, PE">Olinda</option>
                    </select>
                </div>
            </div>

            <!-- Inputs livres (modo personalizado) -->
            <div id="modo-livre" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4" style="display: none;">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo de Origem</label>
                    <input
                        type="text"
                        id="origem-livre"
                        placeholder="Ex: Rua da Aurora, 123, Recife, PE"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                    >
                    <p class="text-xs text-gray-500 mt-1">Comece a digitar para ver sugest√µes</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Endere√ßo de Destino</label>
                    <input
                        type="text"
                        id="destino-livre"
                        placeholder="Ex: Shopping Recife, Recife, PE"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md"
                    >
                    <p class="text-xs text-gray-500 mt-1">Comece a digitar para ver sugest√µes</p>
                </div>
            </div>

            <button onclick="testarDistancia()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                Calcular Dist√¢ncia e Custo
            </button>
            <div id="resultado-distancia" class="mt-4"></div>
        </div>

        <!-- Informa√ß√µes sobre Fonte dos Dados -->
        <div class="bg-gray-50 rounded-xl shadow-lg p-6 mb-6 border border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-gray-900">Fonte dos Dados</h2>

            <div class="space-y-4">
                <!-- Dados da API -->
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                    <h3 class="font-bold text-gray-800 mb-2">API do Google Maps</h3>
                    <ul class="text-sm space-y-1 text-gray-700">
                        <li><strong>Dist√¢ncia:</strong> Calculada por ruas reais</li>
                        <li><strong>Tempo:</strong> Baseado em dados hist√≥ricos de tr√¢nsito</li>
                        <li><strong>N√∫mero de √¥nibus:</strong> Rotas reais de transporte p√∫blico</li>
                        <li><strong>Linhas e paradas:</strong> Informa√ß√µes do sistema de transporte</li>
                    </ul>
                </div>

                <!-- Tarifas de √¥nibus -->
                <div class="bg-white rounded-lg p-4 border border-gray-200">
                    <h3 class="font-bold text-gray-800 mb-2">Tarifas de Transporte</h3>
                    <p class="text-sm text-gray-700 mb-2">
                        A API do Google Maps n√£o fornece valores de tarifas para o Brasil.
                        Utilizamos as tarifas oficiais vigentes em Pernambuco.
                    </p>
                    <p class="text-sm text-gray-700">
                        <strong>Regi√£o Metropolitana do Recife:</strong> R$ 4,30 por passagem<br>
                        <strong>C√°lculo:</strong> Tarifa oficial √ó n√∫mero de embarques (fornecido pela API)
                    </p>
                </div>
            </div>
        </div>

        <!-- Teste de Rota com Transporte P√∫blico -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Teste de Rota com Transporte P√∫blico</h2>
            <button onclick="testarRotaTransporte()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                Buscar Rotas de √înibus
            </button>
            <div id="resultado-rota" class="mt-4"></div>
        </div>

        <!-- Mapa -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Mapa Interativo</h2>
            <div id="map" class="rounded-lg border border-gray-300"></div>
        </div>

        <!-- Teste de Otimiza√ß√£o Completa -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">Teste de Otimiza√ß√£o Completa</h2>
            <p class="text-gray-600 mb-4">Simula a aloca√ß√£o de um paciente considerando todos os fatores</p>
            <button onclick="testarOtimizacao()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                Executar Otimiza√ß√£o
            </button>
            <div id="resultado-otimizacao" class="mt-4"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./src/js/config.js"></script>
    <script src="./src/js/maps-integration.js"></script>
    <script src="./src/js/otimizacao.js"></script>
    <script>
        let map;
        let directionsRenderer;

        // Verificar status da API
        async function verificarAPI() {
            const statusDiv = document.getElementById('api-status');

            try {
                // Tentar carregar Google Maps
                await mapsIntegration.init();

                statusDiv.innerHTML = `
                    <div class="space-y-2">
                        <div class="flex items-center text-green-600">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <strong>Google Maps API conectada com sucesso!</strong>
                        </div>
                        <div class="text-sm text-gray-600 ml-7">
                            <p>‚úì Maps JavaScript API</p>
                            <p>‚úì Distance Matrix API</p>
                            <p>‚úì Directions API</p>
                            <p>‚úì Geocoding API</p>
                        </div>
                    </div>
                `;

                // Inicializar mapa
                inicializarMapa();

            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="flex items-center text-red-600">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        <strong>Erro ao conectar: ${error.message}</strong>
                    </div>
                `;
            }
        }

        function inicializarMapa() {
            const recife = { lat: -8.0476, lng: -34.8770 };

            map = new google.maps.Map(document.getElementById('map'), {
                center: recife,
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });

            // Adicionar marcadores dos principais munic√≠pios
            const municipios = [
                { nome: 'Recife', pos: { lat: -8.0476, lng: -34.8770 } },
                { nome: 'Jaboat√£o', pos: { lat: -8.1128, lng: -35.0148 } },
                { nome: 'Cabo', pos: { lat: -8.2814, lng: -35.0349 } },
                { nome: 'Olinda', pos: { lat: -8.0089, lng: -34.8553 } },
                { nome: 'Igarassu', pos: { lat: -7.8342, lng: -34.9062 } }
            ];

            municipios.forEach(m => {
                new google.maps.Marker({
                    position: m.pos,
                    map: map,
                    title: m.nome
                });
            });

            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                suppressMarkers: false
            });

            // Inicializar autocomplete ap√≥s mapa estar pronto
            inicializarAutocomplete();
        }

        function inicializarAutocomplete() {
            const origemInput = document.getElementById('origem-livre');
            const destinoInput = document.getElementById('destino-livre');

            // Configurar autocomplete para Pernambuco
            const options = {
                componentRestrictions: { country: 'br' },
                fields: ['formatted_address', 'geometry', 'name'],
                types: ['address']
            };

            // Criar autocomplete para origem
            const autocompleteOrigem = new google.maps.places.Autocomplete(origemInput, options);
            autocompleteOrigem.setBounds(new google.maps.LatLngBounds(
                new google.maps.LatLng(-8.5, -35.5), // SW de PE
                new google.maps.LatLng(-7.5, -34.8)  // NE de PE
            ));

            // Criar autocomplete para destino
            const autocompleteDestino = new google.maps.places.Autocomplete(destinoInput, options);
            autocompleteDestino.setBounds(new google.maps.LatLngBounds(
                new google.maps.LatLng(-8.5, -35.5),
                new google.maps.LatLng(-7.5, -34.8)
            ));

            console.log('Autocomplete de endere√ßos inicializado');
        }

        function toggleModoEntrada() {
            const modoSelect = document.getElementById('modo-select');
            const modoLivre = document.getElementById('modo-livre');
            const radioSelecionado = document.querySelector('input[name="modoEntrada"]:checked').value;

            if (radioSelecionado === 'livre') {
                modoSelect.style.display = 'none';
                modoLivre.style.display = 'grid';
            } else {
                modoSelect.style.display = 'grid';
                modoLivre.style.display = 'none';
            }
        }

        async function testarDistancia() {
            const resultadoDiv = document.getElementById('resultado-distancia');
            const modoAtual = document.querySelector('input[name="modoEntrada"]:checked').value;

            let origem, destino;

            if (modoAtual === 'livre') {
                origem = document.getElementById('origem-livre').value.trim();
                destino = document.getElementById('destino-livre').value.trim();

                if (!origem || !destino) {
                    resultadoDiv.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <p class="text-red-800">Por favor, preencha ambos os endere√ßos.</p>
                        </div>
                    `;
                    return;
                }
            } else {
                origem = document.getElementById('origem').value;
                destino = document.getElementById('destino').value;
            }

            resultadoDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center text-blue-600">
                        <span class="loading mr-2"></span>
                        Calculando dist√¢ncia e estimando custos...
                    </div>
                </div>
            `;

            try {
                const resultado = await mapsIntegration.estimarCustoTransporte(origem, destino);

                resultadoDiv.innerHTML = `
                    <div class="bg-white border border-gray-200 rounded-lg p-4 space-y-4">
                        <h3 class="font-semibold text-gray-900 text-lg border-b pb-2">Resultado do C√°lculo</h3>

                        <div class="grid grid-cols-3 gap-4">
                            <div class="bg-gray-50 rounded p-3">
                                <p class="text-sm text-gray-600 mb-1">Dist√¢ncia</p>
                                <p class="text-2xl font-bold text-gray-900">${resultado.distanciaKm} km</p>
                            </div>
                            <div class="bg-gray-50 rounded p-3">
                                <p class="text-sm text-gray-600 mb-1">Tempo de Viagem</p>
                                <p class="text-lg font-bold text-gray-900">${resultado.tempoViagem}</p>
                            </div>
                            <div class="bg-blue-50 rounded p-3 border border-blue-200">
                                <p class="text-sm text-gray-600 mb-1">Custo Estimado</p>
                                <p class="text-2xl font-bold text-blue-600">R$ ${resultado.custoTransportePublico.toFixed(2)}</p>
                                <p class="text-xs text-gray-500 mt-1">${resultado.numeroTransferencias} embarque(s)</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 border-l-4 border-gray-400 p-3">
                            <p class="text-sm font-medium text-gray-900 mb-2">Fonte dos Dados</p>
                            <div class="space-y-1 text-xs text-gray-700">
                                ${resultado.metodoCalculo === 'fallback-driving' ?
                                    '<p class="text-yellow-700">Rota de transporte p√∫blico n√£o dispon√≠vel para este trajeto</p>'
                                    : '<p>Rota de transporte p√∫blico calculada pela API</p>'}
                                <p><strong>Dist√¢ncia e tempo:</strong> Google Maps API</p>
                                <p><strong>N√∫mero de √¥nibus:</strong> ${resultado.metodoCalculo === 'fallback-driving' ? 'Estimado' : 'Google Maps API'}</p>
                                <p><strong>Tarifa:</strong> R$ 4,30 (RMR 2025) √ó ${resultado.numeroTransferencias} embarque(s)</p>
                            </div>
                        </div>
                    </div>
                `;

                // Desenhar rota no mapa
                if (resultado.detalhesRota) {
                    desenharRotaNoMapa(origem, destino);
                }

            } catch (error) {
                resultadoDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p class="text-red-800"><strong>Erro:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        async function testarRotaTransporte() {
            const resultadoDiv = document.getElementById('resultado-rota');
            const origem = document.getElementById('origem').value;
            const destino = document.getElementById('destino').value;

            resultadoDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center text-blue-600">
                        <span class="loading mr-2"></span>
                        Buscando rotas de transporte p√∫blico...
                    </div>
                </div>
            `;

            try {
                const rotas = await mapsIntegration.calcularRotaTransportePublico(origem, destino);

                if (rotas.length === 0) {
                    resultadoDiv.innerHTML = `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-yellow-800">Nenhuma rota de transporte p√∫blico encontrada para este trajeto.</p>
                        </div>
                    `;
                    return;
                }

                let html = `<div class="space-y-4">`;

                rotas.forEach((rota, idx) => {
                    const passosBus = rota.passos.filter(p => p.transitDetails);

                    html += `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-semibold text-green-900">Rota ${idx + 1}</h4>
                                <span class="bg-green-200 text-green-800 px-2 py-1 rounded text-xs">
                                    ${rota.duracao.texto}
                                </span>
                            </div>

                            <div class="space-y-2 mb-3">
                                <p class="text-sm"><strong>Dist√¢ncia:</strong> ${rota.distancia.texto}</p>
                                <p class="text-sm"><strong>Dura√ß√£o:</strong> ${rota.duracao.texto}</p>
                                <p class="text-sm"><strong>√înibus necess√°rios:</strong> ${passosBus.length}</p>
                            </div>

                            <div class="space-y-2">
                                <p class="text-sm font-semibold text-gray-700">Passos da viagem:</p>
                                ${rota.passos.map((passo, i) => {
                                    if (passo.transitDetails) {
                                        return `
                                            <div class="bg-white rounded p-2 text-sm border-l-4 border-blue-500">
                                                <p><strong>üöå ${passo.transitDetails.linha}</strong> - ${passo.transitDetails.veiculo}</p>
                                                <p class="text-xs text-gray-600">De: ${passo.transitDetails.partida}</p>
                                                <p class="text-xs text-gray-600">Para: ${passo.transitDetails.chegada}</p>
                                                <p class="text-xs text-gray-600">${passo.transitDetails.numParadas} paradas ‚Ä¢ ${passo.duracao}</p>
                                            </div>
                                        `;
                                    } else {
                                        return `
                                            <div class="bg-gray-50 rounded p-2 text-xs text-gray-600">
                                                üö∂ ${passo.instrucoes.replace(/<[^>]*>/g, '')} (${passo.duracao})
                                            </div>
                                        `;
                                    }
                                }).join('')}
                            </div>
                        </div>
                    `;
                });

                html += `</div>`;
                resultadoDiv.innerHTML = html;

            } catch (error) {
                resultadoDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p class="text-red-800"><strong>Erro:</strong> ${error.message}</p>
                        <p class="text-xs text-red-600 mt-2">Poss√≠vel causa: Transporte p√∫blico n√£o dispon√≠vel para este trajeto</p>
                    </div>
                `;
            }
        }

        function desenharRotaNoMapa(origem, destino) {
            const directionsService = new google.maps.DirectionsService();

            directionsService.route({
                origin: origem,
                destination: destino,
                travelMode: google.maps.TravelMode.TRANSIT
            }, (result, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(result);
                }
            });
        }

        async function testarOtimizacao() {
            const resultadoDiv = document.getElementById('resultado-otimizacao');
            const origem = document.getElementById('origem').value;

            resultadoDiv.innerHTML = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center text-blue-600">
                        <span class="loading mr-2"></span>
                        Executando otimiza√ß√£o completa...
                    </div>
                </div>
            `;

            try {
                // Criar paciente mock
                const paciente = {
                    id: 'pac-test',
                    nome: 'Paciente Teste',
                    cpf: '123.456.789-00',
                    endereco: origem,
                    idade: 45,
                    gestante: false,
                    urgente: false,
                    especialidade: 'cardiologia'
                };

                // Criar especialistas mock
                const especialistas = [
                    {
                        id: 'esp-1',
                        nome: 'Dr. Cardiologista 1',
                        especialidade: 'cardiologia',
                        municipio: 'Cabo de Santo Agostinho',
                        unidade: 'UPA Cabo',
                        endereco: 'Cabo de Santo Agostinho, PE',
                        tempoEsperaDias: 5,
                        vagasDisponiveis: 3
                    },
                    {
                        id: 'esp-2',
                        nome: 'Dr. Cardiologista 2',
                        especialidade: 'cardiologia',
                        municipio: 'Igarassu',
                        unidade: 'UPA Igarassu',
                        endereco: 'Igarassu, PE',
                        tempoEsperaDias: 2,
                        vagasDisponiveis: 2
                    },
                    {
                        id: 'esp-3',
                        nome: 'Dr. Cardiologista 3',
                        especialidade: 'cardiologia',
                        municipio: 'Recife',
                        unidade: 'UPA Recife',
                        endereco: 'Recife, PE',
                        tempoEsperaDias: 10,
                        vagasDisponiveis: 5
                    }
                ];

                const resultado = await otimizador.encontrarMelhorAlocacao(paciente, especialistas);

                if (resultado.sucesso) {
                    const melhor = resultado.melhorOpcao;

                    resultadoDiv.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 space-y-4">
                            <h3 class="font-semibold text-green-900 text-lg">‚úì Otimiza√ß√£o realizada com sucesso!</h3>

                            <div class="bg-white rounded-lg p-4 border-2 border-green-500">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-bold text-lg">Melhor Op√ß√£o</h4>
                                    <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm">
                                        Score: ${melhor.score.toFixed(3)}
                                    </span>
                                </div>

                                <div class="space-y-2">
                                    <p><strong>Local:</strong> ${melhor.especialista.municipio} - ${melhor.especialista.unidade}</p>
                                    <p><strong>Especialista:</strong> ${melhor.especialista.nome}</p>

                                    <div class="grid grid-cols-2 gap-2 mt-3">
                                        <div class="bg-blue-50 rounded p-2">
                                            <p class="text-xs text-gray-600">Dist√¢ncia</p>
                                            <p class="font-bold">${melhor.detalhes.distancia?.toFixed(1)} km</p>
                                        </div>
                                        <div class="bg-green-50 rounded p-2">
                                            <p class="text-xs text-gray-600">Tempo Espera</p>
                                            <p class="font-bold">${melhor.detalhes.tempoEspera} dias</p>
                                        </div>
                                        <div class="bg-purple-50 rounded p-2">
                                            <p class="text-xs text-gray-600">Custo (√înibus)</p>
                                            <p class="font-bold text-purple-600">R$ ${melhor.detalhes.custo?.toFixed(2)}</p>
                                        </div>
                                        <div class="bg-orange-50 rounded p-2">
                                            <p class="text-xs text-gray-600">Transfer√™ncias</p>
                                            <p class="font-bold">${melhor.detalhes.numeroTransferencias}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3">
                                <p class="font-semibold text-yellow-900 mb-2">Por que esta op√ß√£o?</p>
                                <div class="space-y-1 text-sm">
                                    ${resultado.explicacao.fatores.map(f => `
                                        <div class="flex items-start">
                                            <span class="mr-2">${f.icone}</span>
                                            <span class="text-gray-700">${f.texto}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            ${resultado.alternativas && resultado.alternativas.length > 0 ? `
                                <div>
                                    <p class="font-semibold mb-2">Alternativas:</p>
                                    <div class="space-y-2">
                                        ${resultado.alternativas.map((alt, idx) => `
                                            <div class="bg-gray-50 rounded p-3 text-sm">
                                                <div class="flex justify-between">
                                                    <span><strong>${alt.especialista.municipio}</strong> - ${alt.especialista.nome}</span>
                                                    <span class="text-gray-600">Score: ${alt.score.toFixed(3)}</span>
                                                </div>
                                                <p class="text-xs text-gray-600 mt-1">
                                                    ${alt.detalhes.distancia?.toFixed(1)}km ‚Ä¢ ${alt.detalhes.tempoEspera} dias ‚Ä¢ R$ ${alt.detalhes.custo?.toFixed(2)}
                                                </p>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    resultadoDiv.innerHTML = `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <p class="text-red-800"><strong>N√£o foi poss√≠vel encontrar uma aloca√ß√£o adequada</strong></p>
                        </div>
                    `;
                }

            } catch (error) {
                resultadoDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p class="text-red-800"><strong>Erro na otimiza√ß√£o:</strong> ${error.message}</p>
                        <pre class="text-xs mt-2 bg-white p-2 rounded overflow-auto">${error.stack}</pre>
                    </div>
                `;
            }
        }

        // Inicializar ao carregar
        window.onload = () => {
            verificarAPI();
        };
    </script>
</body>
</html>
